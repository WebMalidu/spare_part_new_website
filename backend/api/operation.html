<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>JSON and Image POST Request</title>
  </head>
  <body>
    <h1>Image Upload</h1>
    <input type="file" id="fileInput" multiple />
    <button id="submitButton">Upload</button>
    <button id="sendRequest">Submit</button>
    <div id="imageContainer"></div>

    <script>
      const insertData = {
        ad_title: "Tensioner Pulley, Timing Belt",
        ad_origin_id: 1,
        ad_qty: 3,
        ad_description:"This Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the  a sample vehicle part.",
        ad_price: 20000,
        ad_brand_id: 1,
        ad_model_id: 7,
        ad_category_id: "CTI_363112",
        ad_parts_img: [],
      };

      function handleUpload() {
        const fileInput = document.getElementById("fileInput");
        const imageContainer = document.getElementById("imageContainer");

        const files = fileInput.files;

        for (let i = 0; i < files.length; i++) {
          const file = files[i];
          const reader = new FileReader();

          reader.onload = function (event) {
            const image = document.createElement("img");
            image.src = event.target.result;
            imageContainer.appendChild(image);

            // Add the uploaded file data to the array
            insertData.ad_parts_img.push(event.target.result);
          };

          reader.readAsDataURL(file);
        }

        // Define the sendRequest function here
        function sendRequest() {
          const form = new FormData();
          form.append("insertData", JSON.stringify(insertData));
          const request = new XMLHttpRequest();
          request.onreadystatechange = function () {
            if (request.readyState == 4) {
              if (request.status == 200) {
                try {
                  const response = JSON.parse(request.responseText);
                  if (response.status == "success") {
                    alert(response.status);
                    console.log(response.result);
                    // Perform further actions if needed
                  } else {
                    console.log(response.error);
                  }
                } catch (error) {
                  console.log("Error parsing JSON: " + error);
                }
              } else {
                console.log("Request failed with status: " + request.status);
              }
            }
          };
          request.open("POST", "productManupulateAPI.php", true);
          // Serialize the form data and send it to the server
          request.send(form);
        }

        // Add a click event listener to the "Submit" button
        const sendButton = document.getElementById("sendRequest");
        sendButton.addEventListener("click", sendRequest);
      }

      const submitButton = document.getElementById("submitButton");
      submitButton.addEventListener("click", handleUpload);
    </script>
  </body>
</html>
